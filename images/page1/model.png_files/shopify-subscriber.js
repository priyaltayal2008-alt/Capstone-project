(function(){function D(a){Object.defineProperty(a,"__esModule",{value:!0,configurable:!0})}function c(a,p,e,l){Object.defineProperty(a,p,{get:e,set:l,enumerable:!0,configurable:!0})}var M=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{},u=M.parcelRequire94c2,f=u.register;f("4Z19s",function(a,p){D(a.exports),c(a.exports,"default",function(){return P});var e=u("aEodP"),l=u("gI2VZ"),E=u("hP9Uw"),A=u("6QfcD"),N=u("eSOI5"),L=u("kCbDV"),i=u("519R9"),y=u("93NPo"),F=u("k6zg1"),T=u("79mIY");const m=U=>({headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify(U)});let _=!1,C=!1;const g={},I={};class R{constructor(){if(R.instance)return R.instance;R.instance=this,this.isShopifyStore=!!(window.Shopify?.shop&&window.Shopify?.routes),this.storeRootUrl=window.Shopify?.routes?.root}getIsProductSoldOutError(t){return t.includes(T.CART_ERROR_MESSAGES.soldOut)}getIsSellingPlanError(t){return t.includes(T.CART_ERROR_MESSAGES.sellingPlanRequired)}formatProduct(t){if(!t)return null;const r=window.Shopify?.currency?.active||window.Shopify?.currency,s=window.tolstoyCurrencySymbol||l.CURRENCY_SYMBOL_MAP[r];return{...t,id:String(t.id),price:t.price/100,compare_at_price:t.compare_at_price?t.compare_at_price/100:t.compare_at_price,currencyCode:r,currencySymbol:s,variants:t.variants.map(o=>({...o,price:o.price/100,compare_at_price:o.compare_at_price?o.compare_at_price/100:o.compare_at_price}))}}async fetchRawProduct(t){const r=this.storeRootUrl+`products/${t}.js`;try{const o=await(await fetch(r)).json();return this.formatProduct(o)}catch{}}getProduct=async t=>{if(g[t])return g[t];if(I[t])return I[t];const r=this.fetchRawProduct(t);I[t]=r;const s=await r;return g[t]=s,delete I[t],s};onRequestProductsUpdateMessage=async({handles:t})=>{const s=[...new Set(t)].map(n=>this.getProduct(n)),o=(await Promise.all(s)).filter(Boolean);for(const n of o)i.default.postMessage({eventName:e.INTERNAL_EVENTS.productUpdateResponse,product:n,isProductUpdateResponse:!0})};async handleSellingPlanError(t,r){const s=await this.getProduct(r);if(!s)return;const{id:o}=s.selling_plan_groups[0].selling_plans[0];return this.shopifyAddToCart({variantId:t,productHandle:r,sellingPlanId:o})}handleAddToCartError({error:t,variantId:r,productHandle:s,transmissionId:o}){const{description:n,message:d}=t;if(this.getIsProductSoldOutError(n||d)){i.default.postMessage({eventName:e.INTERNAL_EVENTS.addToCartSoldOut,variantId:r,transmissionId:o});return}if(this.getIsSellingPlanError(n||d))return this.handleSellingPlanError(r,s);i.default.postMessage({eventName:e.INTERNAL_EVENTS.addToCartError,error:n,variantId:r,transmissionId:o})}handleUpdateItemQuantityError({error:t,variantId:r,transmissionId:s}){const{description:o}=t;i.default.postMessage({eventName:e.INTERNAL_EVENTS.cartItemQuantityChangeError,error:o,variantId:r,transmissionId:s})}async getCart({transmissionId:t}){try{const s=await(await fetch(`${this.storeRootUrl}cart.js`,{method:"GET"})).json();i.default.postMessage({eventName:e.INTERNAL_EVENTS.cartDataResponse,cart:s,transmissionId:t})}catch{}}triggerExternalCartUpdate(){window.VueMiniCart?.$store?._actions?.initCart?.[0]?.(),window.slate?.cart?.reloadCart?.(),window.tolstoyCartRefresh?.(),window.monster_refresh?.(),window.updateMiniCart?.()}disableAddToCart(){_=!0,i.default.unsubscribeMultipleEvents({eventNames:T.ADD_TO_CART_MESSAGES_TO_SUBSCRIBE,callback:this.internalMessagingHandler})}postUrlLocaleUpdateIfNeeded(){window.Shopify?.routes?.root!=="/"&&i.default.postMessage({eventName:e.INTERNAL_EVENTS.urlLocaleUpdate,urlLocale:window.Shopify?.routes?.root})}postIsNonBaseCurrencyIfNeeded(){(0,F.getIsBaseCurrency)()||i.default.postMessage({eventName:e.INTERNAL_EVENTS.isNonBaseCurrency})}shopifyQuickShopClick({product:t}){const{variants:r,handle:s,quantity:o=1}=t,n=r[0].id;return this.shopifyAddToCart({variantId:n,productHandle:s,quantity:o})}shopifyAddToCart=async({variantId:t,productHandle:r,sellingPlanId:s,quantity:o=L.DEFAULT_CART_QUANTITY,transmissionId:n})=>{const d={};C||(d._isAddedFromTolstoy=!0,(0,N.updateIsAddedFromTolstoyVariantIds)(t));const h={id:t,quantity:o,properties:d};s&&(h.selling_plan=s);const b=m({items:[h]});try{const S=await fetch(`${this.storeRootUrl}cart/add.js`,b);if(!S.ok){const w=await S.json();return this.handleAddToCartError({error:w,variantId:t,productHandle:r,transmissionId:n})}this.triggerExternalCartUpdate(),(0,N.updateIsAddedFromTolstoyVariantIds)(t),i.default.postMessage({eventName:e.INTERNAL_EVENTS.addToCartSuccess,variantId:t,transmissionId:n,shouldEndTransmission:!1}),this.getCart({transmissionId:n})}catch(S){console.log(S),this.handleAddToCartError({error:S,variantId:t,productHandle:r,transmissionId:n})}};shopifyUpdateItemQuantity=async({variantId:t,quantity:r,transmissionId:s})=>{const o={updates:{[t]:r}},n=m(o);try{const d=await fetch(`${this.storeRootUrl}cart/update.js`,n);if(!d.ok){const h=await d.json();return this.handleUpdateItemQuantityError({error:h,variantId:t,transmissionId:s})}this.triggerExternalCartUpdate(),i.default.postMessage({eventName:e.INTERNAL_EVENTS.cartItemQuantityChangeSuccess,variantId:t,transmissionId:s,shouldEndTransmission:!1}),this.getCart({transmissionId:s})}catch(d){this.handleUpdateItemQuantityError({error:d,variantId:t,transmissionId:s})}};async getProductRecommendations({productId:t,transmissionId:r}){const s=`${this.storeRootUrl}recommendations/products.json?product_id=${t}`;try{const o=await fetch(s,{method:"GET"}),{products:n}=await o.json();i.default.postMessage({eventName:e.INTERNAL_EVENTS.productRecommendationsResponse,productId:t,products:n,transmissionId:r})}catch{}}async loginWithMultipassUrl({multipassUrl:t,transmissionId:r}){try{const s=await fetch(t);i.default.postMessage({eventName:e.INTERNAL_EVENTS.loginWithMultipassUrlResponse,statusCode:s.status,transmissionId:r})}catch{}}async setAnonymousIdToCart({anonymousId:t}){if((0,N.getIsShopifyCartAnonymousIdSet)()==="true"||C||!(0,y.verifyUserConsent)())return;const r={attributes:{[E.SHOPIFY_CART_ATTRIBUTES.tolstoyAnonymousId]:t}},s=m(r);try{await fetch(`${this.storeRootUrl}cart/update.js`,s),(0,N.setIsShopifyCartAnonymousIdSet)(!0)}catch(o){console.error(o)}}async blockAnonymousIdToCart({appKey:t}){const r=(0,N.getTolstoyInteractionDate)(t);(0,y.isNullOrUndefined)(r)||await this.setAnonymousIdToCart({anonymousId:null}),C=!0}forceClearAnonymousIdFromCart(){if(window.Shopify?.shop!=="mlt-boutique.myshopify.com")return;const t=(0,A.getAppKey)();t&&this.blockAnonymousIdToCart({appKey:t})}internalMessagingHandler=t=>{switch(t.data.eventName){case e.INTERNAL_EVENTS.addToCart:return this.shopifyAddToCart(t.data);case e.INTERNAL_EVENTS.spotlightCarouselQuickShopClick:return this.shopifyQuickShopClick(t.data);case e.INTERNAL_EVENTS.addToCartDisableDefault:return this.disableAddToCart(t.data);case e.INTERNAL_EVENTS.blockAnonymousIdToCart:return this.blockAnonymousIdToCart(t.data);case e.INTERNAL_EVENTS.setAnonymousIdToCart:return this.setAnonymousIdToCart(t.data);case e.INTERNAL_EVENTS.loginWithMultipassUrlRequest:return this.loginWithMultipassUrl(t.data);case e.INTERNAL_EVENTS.cartItemQuantityChange:return this.shopifyUpdateItemQuantity(t.data);case e.INTERNAL_EVENTS.cartDataRequest:return this.getCart(t.data);case e.INTERNAL_EVENTS.productRecommendationsRequest:return this.getProductRecommendations(t.data);case e.INTERNAL_EVENTS.requestProductsUpdate:return this.onRequestProductsUpdateMessage(t.data);default:return null}};initInternalMessagingSubscriptions=()=>{if(i.default.subscribeMultipleEvents({eventNames:T.INTERNAL_MESSAGES_TO_SUBSCRIBE,callback:this.internalMessagingHandler}),_){(0,y.logDevelopmentMessage)("Add to cart disabled");return}i.default.subscribeMultipleEvents({eventNames:T.ADD_TO_CART_MESSAGES_TO_SUBSCRIBE,callback:this.internalMessagingHandler})};init(){this.isShopifyStore&&(this.initInternalMessagingSubscriptions(),this.postUrlLocaleUpdateIfNeeded(),this.postIsNonBaseCurrencyIfNeeded(),this.forceClearAnonymousIdFromCart())}}const $=new R;Object.freeze($);var P=$}),f("gI2VZ",function(a,p){c(a.exports,"CURRENCY_SYMBOL_MAP",function(){return e});const e={USD:"$",CAD:"CA$",EUR:"\u20AC",AED:"\u062F.\u0625.\u200F",AFN:"\u060B",ALL:"Lek",AMD:"\u0564\u0580.",ARS:"$",AUD:"AU$",AZN:"\u043C\u0430\u043D.",BAM:"KM",BDT:"\u09F3",BGN:"\u043B\u0432.",BHD:"\u062F.\u0628.\u200F",BIF:"FBu",BND:"$",BOB:"Bs",BRL:"R$",BWP:"P",BYN:"\u0440\u0443\u0431.",BZD:"$",CDF:"FrCD",CHF:"CHF",CLP:"$",CNY:"CN\xA5",COP:"$",CRC:"\u20A1",CVE:"CV$",CZK:"K\u010D",DJF:"Fdj",DKK:"kr",DOP:"RD$",DZD:"\u062F.\u062C.\u200F",EEK:"kr",EGP:"\u062C.\u0645.\u200F",ERN:"Nfk",ETB:"Br",GBP:"\xA3",GEL:"GEL",GHS:"GH\u20B5",GNF:"FG",GTQ:"Q",HKD:"$",HNL:"L",HRK:"kn",HUF:"Ft",IDR:"Rp",ILS:"\u20AA",INR:"\u20B9",IQD:"\u062F.\u0639.\u200F",IRR:"\uFDFC",ISK:"kr",JMD:"$",JOD:"\u062F.\u0623.\u200F",JPY:"\uFFE5",KES:"Ksh",KHR:"\u17DB",KMF:"FC",KRW:"\u20A9",KWD:"\u062F.\u0643.\u200F",KZT:"\u0442\u04A3\u0433.",LBP:"\u0644.\u0644.\u200F",LKR:"SL Re",LTL:"Lt",LVL:"Ls",LYD:"\u062F.\u0644.\u200F",MAD:"\u062F.\u0645.\u200F",MDL:"MDL",MGA:"MGA",MKD:"MKD",MMK:"K",MOP:"MOP$",MUR:"MURs",MXN:"MX$",MYR:"RM",MZN:"MTn",NAD:"N$",NGN:"\u20A6",NIO:"C$",NOK:"kr",NPR:"\u0928\u0947\u0930\u0942",NZD:"$",OMR:"\u0631.\u0639.\u200F",PAB:"B/.",PEN:"S/.",PHP:"\u20B1",PKR:"\u20A8",PLN:"z\u0142",PYG:"\u20B2",QAR:"\u0631.\u0642.\u200F",RON:"RON",RSD:"\u0434\u0438\u043D.",RUB:"\u20BD.",RWF:"FR",SAR:"\u0631.\u0633.\u200F",SDG:"SDG",SEK:"kr",SGD:"$",SOS:"Ssh",SYP:"\u0644.\u0633.\u200F",THB:"\u0E3F",TND:"\u062F.\u062A.\u200F",TOP:"T$",TRY:"TL",TTD:"$",TWD:"NT$",TZS:"TSh",UAH:"\u20B4",UGX:"USh",UYU:"$",UZS:"UZS",VEF:"Bs.F.",VND:"\u20AB",XAF:"FCFA",XOF:"CFA",YER:"\u0631.\u064A.\u200F",ZAR:"R",ZMK:"ZK",ZWL:"ZWL$"}}),f("hP9Uw",function(a,p){c(a.exports,"ADD_TO_CART_ERROR_DESCRIPTIONS",function(){return e}),c(a.exports,"SHOPIFY_CART_ATTRIBUTES",function(){return l});const e={itemSoldOut:"itemSoldOut"},l={tolstoyAnonymousId:"__tolstoyAnonymousId"}}),f("k6zg1",function(a,p){c(a.exports,"getIsBaseCurrency",function(){return e}),c(a.exports,"isShopifyCdnUrl",function(){return l});const e=()=>Number(window.Shopify?.currency?.rate)===1,l=E=>typeof E=="string"&&E.includes("cdn.shopify.com")}),f("79mIY",function(a,p){c(a.exports,"CART_ERROR_MESSAGES",function(){return l}),c(a.exports,"INTERNAL_MESSAGES_TO_SUBSCRIBE",function(){return E}),c(a.exports,"ADD_TO_CART_MESSAGES_TO_SUBSCRIBE",function(){return A});var e=u("aEodP");const l={soldOut:"already sold out",sellingPlanRequired:"Variant can only be purchased with a selling plan."},E=[e.INTERNAL_EVENTS.addToCartDisableDefault,e.INTERNAL_EVENTS.setAnonymousIdToCart,e.INTERNAL_EVENTS.loginWithMultipassUrlRequest,e.INTERNAL_EVENTS.cartItemQuantityChange,e.INTERNAL_EVENTS.cartDataRequest,e.INTERNAL_EVENTS.productRecommendationsRequest,e.INTERNAL_EVENTS.requestProductsUpdate,e.INTERNAL_EVENTS.blockAnonymousIdToCart],A=[e.INTERNAL_EVENTS.addToCart,e.INTERNAL_EVENTS.spotlightCarouselQuickShopClick]})})();
