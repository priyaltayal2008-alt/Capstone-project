(function(){function h(s){Object.defineProperty(s,"__esModule",{value:!0,configurable:!0})}function p(s,d,c,a){Object.defineProperty(s,d,{get:c,set:a,enumerable:!0,configurable:!0})}var E=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{},n=E.parcelRequire94c2,f=n.register;f("SMK6d",function(s,d){h(s.exports),p(s.exports,"default",function(){return w});var c=n("lY4N9"),a=n("kCbDV"),C=n("6QfcD"),S=n("i1NbZ"),T=n("fgRdL"),I=n("2S3LN");const u="data-status",g=[a.COLLECTION_TILE_EMBED_WIDGET],r={loading:"loading",loaded:"loaded",failed:"notFound"},m=()=>{const l=document.querySelector("script[data-collection-id]")?.dataset?.collectionId||document.querySelector("[data-collection-id]")?.dataset?.collectionId;return l?.includes("{{ collection.id")||!l?null:l},$=({element:l,callback:e,outOfViewCallback:t})=>{const i=new window.IntersectionObserver(o=>{o[0].isIntersecting===!0&&o[0].intersectionRatio>.9?(t||i.unobserve(l),e()):o[0].intersectionRatio<.1&&t?.()},{threshold:[.1,.9]});i.observe(l)};class b{constructor({name:e,component:t,elementClassname:i}){this.name=e,this.Component=t,this.widgets=[],this.initialized=!1,this.elementClassname=i,this.initTemplatesState=this.initAdditionalTemplates()}async init(){await this.initTemplatesState;const e=this.getElements();if(e.length!==0){for(const t of e)if(this.getShouldInitializeElement(t)){if(g.includes(this.name)&&this.widgets.length>0)break;this.setElementStatus(t,r.loading);try{const i=new this.Component;if(await i.init(t,this.preloadedConfigs.find(o=>o.projectId===t.dataset.projectId)),!i.getIsInitialized()){this.setElementStatus(t,r.failed);continue}if(this.widgets.push(i),this.initializeEvents({element:t,widget:i}),this.setElementStatus(t,r.loaded),g.includes(this.name))break}catch(i){this.setElementStatus(t,r.failed),console.log(`error starting  tolstoy ${this.name}`,t.id,i)}}this.widgets.length>0&&(this.initialized=!0)}}deleteElementStatus(e){delete e.removeAttribute(u)}getElementStatus(e){return e.getAttribute(u)}getIsTolstoyPreview(){return window.tolstoyPreview}getIsElementHidden(e){return window.getComputedStyle(e)?.display==="none"||!e.offsetParent}setElementStatus(e,t){return e.setAttribute(u,t)}getShouldInitializeElement(e){return e.classList.contains(T.PUBLIC_CLASS)&&!this.getElementStatus(e)?!0:!this.getElementStatus(e)&&!this.getIsElementHidden(e)||!this.getElementStatus(e)&&(0,c.getIsTapcart)()||this.getIsTolstoyPreview()}setComponent(e){this.Component=e}async loadWidgetAdditionalConfigs(){if(this.preloadedConfigs)return this.preloadedConfigs;try{const e=(0,C.getAppKey)(),t=m(),i=(0,S.getParameterFromWidgetScripts)("collection-gallery-projects");if(!i)return[];const o=JSON.parse(i);if(t&&e&&o?.length){const{getCollectionTileConfigs:v}=await Promise.resolve(n("kK0IS"));return v(e,t)}}catch(e){console.log(e)}return[]}async initAdditionalTemplates(){if(this.name!==a.COLLECTION_TILE_EMBED_WIDGET){this.preloadedConfigs=[];return}try{const e=await this.loadWidgetAdditionalConfigs();this.preloadedConfigs=e;const{initCollectionTileTemplates:t}=await n("3jSu4");await t(this.preloadedConfigs)}catch(e){console.error("error initializing additional templates",e)}}getElements(){return g.includes(this.name)?[...document.querySelectorAll(`.${this.elementClassname}`)].filter(Boolean):[...document.querySelectorAll(`.${this.elementClassname}`)]}shouldLoad(){const e=m();return!this.initTemplatesState.isResolved&&this.name===a.COLLECTION_TILE_EMBED_WIDGET&&e?!0:this.getElements().length>0}initializeEvents({element:e,widget:t}){t.handlePageView?.(),this.registerEmbedViewListener({element:e,callback:t.handleView,outOfViewCallback:t.handleOutOfView})}registerEmbedViewListener({element:e,callback:t,outOfViewCallback:i}){(0,I.getIsElementVisible)({element:e})&&(t(),!i)||$({element:e,callback:t,outOfViewCallback:i})}}var w=b}),f("3jSu4",function(s,d){s.exports=n("1rN27")(n("jHnDr").resolve("7SdT5")).then(()=>n("7ZKOP"))})})();
