(function(){function b(i,$,t,n){Object.defineProperty(i,$,{get:t,set:n,enumerable:!0,configurable:!0})}var T=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{},d=T.parcelRequire94c2,y=d.register;y("jWPpp",function(i,$){b(i.exports,"commonLoader",function(){return l});var t=d("2apiB");let n=!1;const l=async()=>{n||((0,t.initializeWidgetEvents)(),n=!0)}}),y("2apiB",function(i,$){b(i.exports,"initializeWidgetEvents",function(){return r});var t=d("igWUq"),n=d("eSOI5"),l=d("aQK74");let p=!1;const E=()=>{window.addEventListener("message",a=>{a.data&&((0,t.handleTolstoyStart)(a),(0,t.handleOpenIntegration)(a),(0,t.handleHideIntegration)(a),(0,l.sendAnalyticsToExternalSource)(a),(0,t.handleWatchedProductIds)(a))})},h=()=>{const a=new URLSearchParams(window.location.search),w=a.get("tolstoy-reply"),f=a.get("tolstoy-product-recommendation"),u=a.get("tolstoy-app-key");f&&((0,n.setTolstoyProductRecommendation)(),(0,n.setTolstoyInteractionDate)(u)),w&&((0,n.setIsReply)(w),(0,n.setPublishId)(w)),p=!0},r=()=>{p||(E(),h())}}),y("igWUq",function(i,$){b(i.exports,"handleTolstoyStart",function(){return A}),b(i.exports,"handleWatchedProductIds",function(){return _}),b(i.exports,"handleOpenIntegration",function(){return N}),b(i.exports,"handleHideIntegration",function(){return P});var t=d("50h3S"),n=d("bvKjB"),l=d("8ptJJ"),p=d("519R9"),E=d("aEodP"),h=d("93NPo"),r=d("eSOI5");let a,w="";const f=e=>{e.data.eventName===l.TOLSTOY_PLAYER_READY_MESSAGE&&document.querySelector("#tolstoy")?.contentWindow.postMessage({parentUrl:`${window.location.origin}${window.location.pathname}`.slice(0,1999),name:"setTolstoyData",eventName:"setTolstoyData"},"*")},u=e=>{const o=document.querySelector("#smile-ui-container");e&&(w=o?.style.display||""),o?.style?.setProperty("display",e||w)},I=e=>{let o=0;return c=>{try{c()}catch(s){try{if(!(0,h.verifyUserConsent)())return;fetch("https://api.gotolstoy.com/events/event",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({eventName:"widgetError",text:s.message,timestamp:new Date().toISOString(),parentUrl:window.location.href,appKey:e.data.appKey,publishId:e.data.publishId,sessionId:e.data.sessionId,source:e.data.name,answerKey:`${o}`,currentPageProductId:c.toString(),formData:`${(s&&s.stack||"").slice(0,1999)}`})})}catch(pe){(0,h.logDevelopmentError)(pe)}}finally{o++}}},A=e=>{if(e.data.name===t.PLAYER_EVENT_NAMES.sessionStart||e.data.name===t.PLAYER_EVENTS.autoplayStart){const o=I(e);o(()=>(0,r.setPublishId)(e.data.publishId)),o(()=>(0,r.setTolstoyInteractionDate)(e.data.appKey,e.data.appUrl)),o(()=>(0,r.setSessionId)(e.data.sessionId)),o(()=>(0,r.updateTolstoyActivitySessionIdByPublishId)(e.data.publishId,e.data.sessionId)),o(()=>u("none")),o(()=>S(e.data.anonymousId))}},he=e=>{e.data.name===n.EVENT_NAMES.tolstoyModalClose&&u()},S=e=>{window.Shopify&&p.default.postMessage({eventName:E.INTERNAL_EVENTS.setAnonymousIdToCart,anonymousId:e})},_=({data:{name:e,publishId:o,productIds:c}={}})=>{if(e===l.TOLSTOY_WATCHED_PRODUCT_IDS_MESSAGE)for(const s of c)(0,r.pushTolstoyViewedProducts)({productId:s,publishId:o})},N=e=>{g[e.data.name]&&g[e.data.name](e.data)},P=e=>{v[e.data.name]&&setTimeout(()=>v[e.data.name](),500)},H=()=>{window.GorgiasChat&&(window.GorgiasChat.open?.(),window.tolstoyWidget.hide(),document.head.insertAdjacentHTML("beforeend","<style>#gorgias-chat-container iframe#chat-button { visibility: visible !important; display: block !important; }</style>"))},C=()=>{window.GorgiasChat&&(window.GorgiasChat.close?.(),document.head.insertAdjacentHTML("beforeend","<style>#gorgias-chat-container iframe#chat-button { visibility: hidden; display: none; }</style>"))},R=()=>{window.adaEmbed&&(window.adaEmbed.toggle(),window.tolstoyWidget.hide())},O=()=>{document.head.insertAdjacentHTML("beforeend","<style>#ada-button-frame { display: none; }</style>")},W=()=>{window.fcWidget&&(window.fcWidget.show(),window.fcWidget.open(),window.tolstoyWidget.hide())},L=()=>{window.fcWidget&&(window.fcWidget.close(),window.fcWidget.hide(),window.tolstoyWidget.show())},M=()=>{if(!a&&window.Reamaze?.popup){window.Reamaze.popup(),window.tolstoyWidget.hide();return}window._support&&a&&window.Reamaze?.reload&&(window._support.ui=a,window.Reamaze.reload(),a=null,window.tolstoyWidget.hide())},D=()=>{window._support?.ui&&window.Reamaze?.reload&&(a=window._support.ui,delete window._support.ui,window.Reamaze.reload(),window.tolstoyWidget.show())},x=()=>{const e=setTimeout(()=>clearInterval(o),9e3),o=setInterval(()=>{window.Intercom&&(window.Intercom("show"),window.tolstoyWidget.hide(),clearInterval(o),clearTimeout(e),window.Intercom("onHide",()=>{window.tolstoyWidget.show()}))})},z=()=>{const e=setTimeout(()=>clearInterval(o),9e3),o=setInterval(()=>{window.Intercom&&(window.Intercom("update",{hide_default_launcher:!0}),clearInterval(o),clearTimeout(e))},100)},V=()=>{window.Tawk_API&&(window.Tawk_API.maximize(),window.tolstoyWidget.hide())};function Y(){window.Tawk_API&&window.Tawk_API.hideWidget()}const k=()=>{window.LiveChatWidget&&(window.LiveChatWidget.call("maximize"),window.tolstoyWidget.hide())};function B(){window.LiveChatWidget&&window.LiveChatWidget.call("hide")}const G=()=>{window.HubSpotConversations&&window.HubSpotConversations.widget&&(window.HubSpotConversations.widget.open(),window.tolstoyWidget.hide())};function q(){window.HubSpotConversations&&window.HubSpotConversations.widget&&window.HubSpotConversations.widget.close()}const j=()=>{window.Beacon&&(window.Beacon("open"),window.tolstoyWidget.hide(),window.Beacon("config",{display:{zIndex:"99999"}}))},U=()=>{window.Beacon&&window.Beacon("config",{display:{zIndex:"0"}})},K=()=>{window.drift&&(window.drift.api.toggleChat(),window.tolstoyWidget.hide())},F=()=>{window.drift&&window.drift.api.widget.hide()},Z=()=>{window.zE&&(window.zE("messenger","open"),document.querySelector('[title="Button to launch messaging window"]')?.style?.setProperty("display","block"),window.tolstoyWidget.hide())},J=()=>{const e=setTimeout(()=>clearInterval(o),5e3),o=setInterval(()=>{const c=document.querySelector('[title="Button to launch messaging window"]'),s=document.querySelector('[title="Message from company"]');c?.style?.setProperty("display","none"),s?.parentElement?.style?.setProperty("display","none"),c&&s&&(clearInterval(o),clearTimeout(e))},100);window.zE&&window.zE("messenger","close")},Q=()=>{window.tidioChatApi&&(window.tidioChatApi.show(),window.tidioChatApi.open(),window.tolstoyWidget.hide())},X=()=>{window.tidioChatApi&&window.tidioChatApi.close()},ee=e=>{if(window.certainly)switch(window.certainly.widgetStatus({action:"open"}),window.tolstoyWidget.hide(),e.data.key){case"PmkMI":window.certainly.goTo({module:"670442"});break;case"_23Hl":window.certainly.goTo({module:"670178"});break;case"P9rfq":window.certainly.goTo({module:"670179"});break;default:break}},te=()=>{window.certainly&&window.certainly.widgetStatus({action:"hide"})},m=e=>{document.head.insertAdjacentHTML("beforeend",`<style>${e} { visibility: hidden; display: none; }</style>`)},oe=()=>{m("#vfChat+div"),m("#vfChat+div+div")},ae="tolstoyHideFreshChat",de="tolstoyOpenFreshChat",ne="tolstoyHideReamaze",ie="tolstoyOpenReamaze",se="tolstoyHideAda",re="tolstoyOpenAda",ce="tolstoyHideTidio",be="tolstoyOpenTidio",le="tolstoyHideCertainly",we="tolstoyOpenCertainly",$e="tolstoyHideVfChat",g={[t.PLAYER_EVENT_NAMES.openGorgias]:H,[t.PLAYER_EVENT_NAMES.openIntercom]:x,[t.PLAYER_EVENT_NAMES.openTawkTo]:V,[t.PLAYER_EVENT_NAMES.openLiveChat]:k,[t.PLAYER_EVENT_NAMES.openHubSpot]:G,[t.PLAYER_EVENT_NAMES.openDrift]:K,[t.PLAYER_EVENT_NAMES.openZendesk]:Z,[t.PLAYER_EVENT_NAMES.openHelpScout]:j,[de]:W,[ie]:M,[re]:R,[be]:Q,[we]:ee},v={[t.PLAYER_EVENT_NAMES.hideGorgias]:C,[t.PLAYER_EVENT_NAMES.hideIntercom]:z,[t.PLAYER_EVENT_NAMES.hideTawkTo]:Y,[t.PLAYER_EVENT_NAMES.hideLiveChat]:B,[t.PLAYER_EVENT_NAMES.hideHubSpot]:q,[t.PLAYER_EVENT_NAMES.hideDrift]:F,[t.PLAYER_EVENT_NAMES.hideZendesk]:J,[t.PLAYER_EVENT_NAMES.hideHelpScout]:U,[ae]:L,[ne]:D,[se]:O,[$e]:oe,[ce]:X,[le]:te}})})();
