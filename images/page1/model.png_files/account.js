(function(){function r(n,E,c,p){Object.defineProperty(n,E,{get:c,set:p,enumerable:!0,configurable:!0})}var B=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{},d=B.parcelRequire94c2,x=d.register;x("bkGGB",function(n,E){r(n.exports,"default",function(){return h});var c=d("i1NbZ"),p=d("kK0IS"),l=d("6QfcD"),T=d("k3iEx"),a=d("93NPo"),u=d("a78DZ"),i=d("izL3O");class o{constructor(){if(o.instance)return o.instance;o.instance=this,this.appKey=(0,l.getAppKey)(),this.shop=(0,i.getShop)()||window.Shopify?.shop,this.accountSettings=null,this.rules=new u.default,this.shouldUseCache=null,this.cacheVersion=null,this.hasLiveBubble=null}async init(){if(!(!this.appKey&&!this.shop)){if(this.accountSettings)return this.accountSettings;try{this.accountSettings=await(0,p.getAccountSettings)(),this.rules.updateRules(this.accountSettings),(this.accountSettings?.shouldUseCache||(0,c.getShouldUseCache)())&&(window.tolstoySettings=window.tolstoySettings||{},window.tolstoySettings.shouldUseCache=!0);const U=this.accountSettings?.cacheVersion||(0,c.getCacheVersion)();return U&&(window.tolstoySettings=window.tolstoySettings||{},window.tolstoySettings.cacheVersion=U),window.tolstoySettings.hasLiveShopAssistant=this.accountSettings?.hasLiveShopAssistant,this.hasLiveBubble=this.accountSettings?.hasLiveBubble||!!window.tolstoyWidgetId||(0,T.getTolstoyAutoOpen)(),this.accountSettings}catch(f){return(0,a.logDevelopmentError)("Error loading account settings",f),null}}}}var h=new o}),x("k3iEx",function(n,E){r(n.exports,"isShopifyStore",function(){return y}),r(n.exports,"getCustomerId",function(){return _}),r(n.exports,"getEmailFromParams",function(){return L}),r(n.exports,"getTolstoyAutoOpen",function(){return W}),r(n.exports,"getTolstoyAutoOpenOnYou",function(){return Q}),r(n.exports,"getTolstoyStartVideo",function(){return Z}),r(n.exports,"getTolstoyMoneyFormat",function(){return P}),r(n.exports,"getIframeSource",function(){return q});var c=d("eSOI5"),p=d("2Aomz"),l=d("kCbDV"),T=d("37dzN"),a=d("izL3O"),u=d("8ZCcc"),i=d("lUrCX"),o=d("lY4N9"),s=d("93NPo");const h=(e,b,m)=>{if(m)return`${p.ON_YOU_URL}`;const $=(0,u.getPlayerOrigin)(e);if($){const I=(0,s.getSafeParameter)("td"),g=f(e);return I&&g?$.replace("2.0.0","2.0.0-ls"):g?$.replace("2.0.0","2.0.0-l"):I?$.replace("2.0.0","2.0.0-s"):$}let w=`${p.PLAYER_URL}`;return b&&(w+="/feed"),e.publishId&&(w+=`/${e.publishId}`),w},y=()=>!!(window.Shopify&&window.Shopify?.routes),f=e=>e.playerLazy||(0,s.getSafeParameter)("pl"),U=e=>e?.featureSettings?.[T.FEATURE_PLAYER_VERSION]?.version,K=e=>e?.carouselEmbed?.carouselPlayInTileFirst?l.IN_TILE_CAROUSEL_EMBED_WIDGET:"",_=()=>window._st?.cid||window.ShopifyAnalytics?.meta?.page?.customerId||"",M=()=>new URLSearchParams(window.location.search).get("authToken"),L=()=>window.tolstoyUserInfo?.email||window.tolstoyUser,W=()=>(0,s.getSafeParameter)(l.URL_PARAMETERS.tolstoyAutoOpen)||window.tolstoyAutoOpen,Q=()=>(0,s.getSafeParameter)(l.URL_PARAMETERS.tolstoyAutoOpenOnYou)||window.tolstoyAutoOpenOnYou,Z=()=>(0,s.getSafeParameter)(l.URL_PARAMETERS.tolstoyStartVideo)||window.tolstoyStartVideo,P=()=>{const e=window.tolstoyMoneyFormat;return e?encodeURIComponent(e):""},H=({data:e,onYouMode:b})=>{const m=(0,a.getShop)(),{productId:$}=e,w=`${window.location.origin}${window.location.pathname}`,I=window.location.href,g=localStorage.getItem("tolstoy-anonymousId"),A=Array.from(document.querySelectorAll("div")||{}).find(S=>S.textContent.trim()==="Size & Fit"),R=Array.from(A?.nextElementSibling?.childNodes||{}).filter(S=>S.nodeType===Node.TEXT_NODE).map(S=>S.textContent.trim()).join(" "),t=new URLSearchParams;return t.append("appUrl",m),t.append("productId",$),t.append("url",w),t.append("urlWithQueryParams",I),t.append("isTolstoyStories","true"),g&&t.append("tolstoyAnonymousId",g),R&&t.append("productFitDetails",R),b&&t.append("mode",b),t.toString().split("&")},j=({data:e,isFeed:b,isOnYou:m,email:$,isDynamic:w,modalId:I,tolstoyStartVideo:g,onYouMode:A})=>{if(m)return H({data:e,onYouMode:A});const t=[`url=${`${window.location.origin}${window.location.pathname}`.slice(0,1999)}`,`modalId=${I}`];e.publishId&&t.push(`publishId=${e.publishId}`);const S=M();S&&t.push(`authToken=${S}`);const F=$||L();F&&t.push(`email=${encodeURIComponent(F)}`),e.productId&&t.push(`productId=${e.productId}`),e.currentProductDbId&&t.push(`currentPageDbProductId=${e.currentProductDbId}`);const C=(0,a.getShop)(),X=!!(y()&&C);if(t.push("host",`safari=${!!window?.safari}`,`dontDownload=${!!e.dontDownload}`,`playerType=${e.playerType}`,`isShopifyStore=${X}`,`shopifyStoreUrl=${C}`,`ai=${(0,c.getAndSetAnonymousId)()}`),y()){const O=window.Shopify?.routes?.root;O&&t.push(`shopifyRootRoute=${O}`)}if(window.tolstoyUserInfo?.name&&t.push(`name=${encodeURIComponent(window.tolstoyUserInfo.name)}`),window.tolstoyUserInfo?.phone&&t.push(`phone=${encodeURIComponent(window.tolstoyUserInfo.phone)}`),window.tolstoyMoneyFormat){const O=P();t.push(`tolstoyMoneyFormat=${O}`)}g&&t.push(`tolstoyStartVideo=${g}`),e.testGroup&&t.push(`group=${e.testGroup}`),e.sneakpeek&&t.push("sneakpeek"),e.sneakpeek_hidden&&t.push("sneakpeek_hidden"),e.token&&t.push(`token=${e.token}`),e.gclid&&t.push(`gclid=${e.gclid}`),e.widgetDelay&&t.push("delay"),e.isShoppable===!1&&t.push(`isShoppable=${e.isShoppable}`),e.appKey&&t.push(`appKey=${e.appKey}`),e.filters&&t.push("isPlatformPlayer=true");const D=e.si||(0,c.getSessionId)();D&&t.push(`si=${D}`);const v=(0,s.getSafeParameter)("td");v&&t.push(`td=${v}`);const V=f(e);V&&t.push(`pl=${V}`);const k=U(e);k&&t.push(`pv=${k}`);const N=K(e);N&&t.push(`playerVariant=${N}`),w&&t.push("isDynamic=true");const G=_();G&&t.push(`customerId=${G}`);const Y=(0,i.getUrlCustomParams)();Y.size>0&&t.push(Y.toString()),(0,o.getIsTapcart)()&&t.push("isTapcart=true");const z=(0,u.getPlayerOrigin)(e);return z&&e.publishId&&t.push(`publishId=${e.publishId}`),z&&b&&t.push("isFeed=true"),window.tolstoySettings?.shouldUseCache&&t.push(`shouldUseCache=${window.tolstoySettings?.shouldUseCache}`),window.tolstoySettings?.cacheVersion&&t.push(`cacheVersion=${window.tolstoySettings?.cacheVersion}`),(0,s.verifyUserConsent)()||t.push("userConsent=false"),t},q=({data:e,isFeed:b,isOnYou:m,email:$,isDynamic:w,modalId:I,tolstoyStartVideo:g,onYouMode:A})=>{const R=h(e,b,m),t=j({data:e,isFeed:b,isOnYou:m,email:$,isDynamic:w,modalId:I,tolstoyStartVideo:g,onYouMode:A});return`${R}?${t.join("&")}`}}),x("37dzN",function(n,E){r(n.exports,"FEATURE_PLAYER_VERSION",function(){return c});const c="player-version"}),x("8ZCcc",function(n,E){r(n.exports,"getFeatureSettings",function(){return p}),r(n.exports,"getFeatureIsEnabled",function(){return l}),r(n.exports,"getIsPlayerLazy",function(){return T}),r(n.exports,"getPlayerOrigin",function(){return a}),r(n.exports,"getIsFallbackVideoDisabled",function(){return u});var c=d("dQiGr");const p=({config:i,featureKey:o})=>i?.featureSettings?.[o],l=({config:i,featureKey:o})=>!!i?.featureSettings?.[o],T=(i={})=>p({config:i,featureKey:c.FEATURE_WIDGET_LOADING})?.playerLazy,a=(i={})=>p({config:i,featureKey:c.FEATURE_WIDGET_LOADING})?.playerOrigin,u=(i={})=>p({config:i,featureKey:c.FEATURE_WIDGET_FALLBACK_VIDEO})?.dontUseFallback}),x("dQiGr",function(n,E){r(n.exports,"FEATURE_WIDGET_LOADING",function(){return c}),r(n.exports,"FEATURE_WIDGET_ONYOU",function(){return p}),r(n.exports,"FEATURE_WIDGET_ONYOU_ALL_PAGES",function(){return l}),r(n.exports,"FEATURE_WIDGET_FALLBACK_VIDEO",function(){return a}),r(n.exports,"FEATURE_CAROUSEL_SHOW_DOTS",function(){return u}),r(n.exports,"FEATURE_CAROUSEL_VIDEOS",function(){return i}),r(n.exports,"FEATURE_HIDE_SPOTLIGHT_PLUS_BUTTON",function(){return o}),r(n.exports,"FEATURE_APP_USE_CREATOR_PROFILE",function(){return h}),r(n.exports,"FEATURE_BLOCK_SHOPIFY_ADD_TO_CART_ATTRIBUTE",function(){return y}),r(n.exports,"FEATURE_SHOPIFY_PRICE_FORMATTING",function(){return f}),r(n.exports,"FEATURE_STORIES_SEARCH_BAR_CUSTOMIZATION",function(){return U});const c="widget-loading",p="widget-onyou",l="widget-onyou-enableAllPages",T="widget-site-activity-event",a="widget-video-fallback",u="carousel-show-dots",i="carousel-videos",o="hide-spotlight-plus-button",s="spotlight-auto-resize",h="app-use-creator-profile",y="block-shopify-add-to-cart-attribute",f="shopify-price-formatting",U="stories-search-bar-customization"}),x("a78DZ",function(n,E){r(n.exports,"default",function(){return l});var c=d("eSOI5");class p{addHours(a,u=new Date){return u.setTime(u.getTime()+a*36e5),u}getTolstoyViewers(){const a=(0,c.getTolstoyViewers)();for(const[i,o]of Object.entries(a)){const s=o.restrictionLimits;!s||!(s?.time&&new Date(s?.time)<=new Date)||delete a[i].restrictionLimits}const u=JSON.stringify(a);return(0,c.setTolstoyViewers)(a),u}updateRestrictions(a,u){const i=(0,c.getTolstoyViewers)(),o=i[u]?.restrictionLimits;if(!o||o?.type!==a)return;const s=o[a];o[a]=s?s+1:1,o.limit&&o.clickLimit===o[a]&&(o.time=this.addHours(o?.limit)),i[u].restrictionLimits=o,(0,c.setTolstoyViewers)(i)}updateRules(a){const u=a?.publishId||void 0,i=a?.limit,o=(0,c.getTolstoyViewers)();let s=o[u];const h=s?.restrictionLimits;s?s.impressionCount+=1:s={impressionCount:1,playCount:0};let y=o.undefined;if(y?y.impressionCount+=1:y={impressionCount:1,playCount:0},i){let f={limit:Number(i.timeLimit),type:i.type,clickLimit:Number(i.clickLimit)};h&&(f={...h,...f}),s.restrictionLimits=f}else h&&(s.restrictionLimits=null);o[u]=s,o.undefined=y,(0,c.setTolstoyViewers)(o)}}var l=p})})();
